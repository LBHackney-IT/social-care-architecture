(self.webpackChunksocial_care_system=self.webpackChunksocial_care_system||[]).push([[985],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return p},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),k=c(a),m=r,d=k["".concat(s,".").concat(m)]||k[m]||u[m]||o;return a?n.createElement(d,i(i({ref:t},p),{},{components:a})):n.createElement(d,i({ref:t},p))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=k;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},8711:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return k}});var n=a(2122),r=a(9756),o=(a(7294),a(3905)),i=["components"],l={id:"connecting-to-live-databases",title:"Connecting to live databases"},s=void 0,c={unversionedId:"runbooks/core-pathways/every-day/connecting-to-live-databases",id:"runbooks/core-pathways/every-day/connecting-to-live-databases",isDocsHomePage:!1,title:"Connecting to live databases",description:"\u26a0\ufe0f Warning: Particularly if you're connecting to a production database,",source:"@site/docs/runbooks/core-pathways/every-day/connecting-to-live-databases.md",sourceDirName:"runbooks/core-pathways/every-day",slug:"/runbooks/core-pathways/every-day/connecting-to-live-databases",permalink:"/social-care-architecture/runbooks/core-pathways/every-day/connecting-to-live-databases",editUrl:"https://github.com/LBHackney-IT/social-care-architecture/edit/main/docs/runbooks/core-pathways/every-day/connecting-to-live-databases.md",version:"current",frontMatter:{id:"connecting-to-live-databases",title:"Connecting to live databases"},sidebar:"docs",previous:{title:"Resident Search Configuration",permalink:"/social-care-architecture/runbooks/case-viewer/search-functionality/resident-search"},next:{title:"Working with Audit Tables",permalink:"/social-care-architecture/runbooks/core-pathways/every-day/working-with-audit-tables"}},p=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Environments",id:"environments",children:[]},{value:"Connecting to the PostgreSQL (RDS PostgreSQL) database",id:"connecting-to-the-postgresql-rds-postgresql-database",children:[]}],u={toc:p};function k(e){var t=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u26a0\ufe0f ",(0,o.kt)("strong",{parentName:"p"},"Warning"),": Particularly if you're connecting to a production database,\nproceed with caution and if possible, look to pair with someone else and mark\nthe connection read-only.")),(0,o.kt)("p",null,"Using details in AWS and a database client, you can connect via a bastion host\nto the PostgreSQL database for the application from your local machine."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Access to the relevant AWS account for the environment, see ",(0,o.kt)("a",{parentName:"li",href:"#environments"},"environments")),(0,o.kt)("li",{parentName:"ul"},"A database client e.g. ",(0,o.kt)("a",{parentName:"li",href:"https://www.pgadmin.org"},"pgAdmin"),", ",(0,o.kt)("a",{parentName:"li",href:"https://www.jetbrains.com/datagrip/"},"DataGrip"),", etc.")),(0,o.kt)("h2",{id:"environments"},"Environments"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Environment"),(0,o.kt)("th",{parentName:"tr",align:null},"AWS account"),(0,o.kt)("th",{parentName:"tr",align:null},"Key"),(0,o.kt)("th",{parentName:"tr",align:null},"EC2 bastion"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Testing"),(0,o.kt)("td",{parentName:"tr",align:null},"Social-Care-Workflows-Staging"),(0,o.kt)("td",{parentName:"tr",align:null},"dev"),(0,o.kt)("td",{parentName:"tr",align:null},"social-care-workflows-dev-bastion")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Staging"),(0,o.kt)("td",{parentName:"tr",align:null},"Social-Care-Workflows-Staging"),(0,o.kt)("td",{parentName:"tr",align:null},"stg"),(0,o.kt)("td",{parentName:"tr",align:null},"social-care-workflows-stg-bastion")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Production"),(0,o.kt)("td",{parentName:"tr",align:null},"Social-Care-Workflows-Production"),(0,o.kt)("td",{parentName:"tr",align:null},"prod"),(0,o.kt)("td",{parentName:"tr",align:null},"social-care-workflows-prod-bastion")))),(0,o.kt)("h2",{id:"connecting-to-the-postgresql-rds-postgresql-database"},"Connecting to the PostgreSQL (RDS PostgreSQL) database"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u2139\ufe0f ",(0,o.kt)("strong",{parentName:"p"},"Information"),": The steps and terminology for each database client will be\nslightly different, but they'll all ask for the same information.")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Open your database client and add a new data source for a PostgreSQL database"),(0,o.kt)("li",{parentName:"ol"},"Name your database source e.g. Workflows (Staging)")),(0,o.kt)("p",null,"Within the relevant AWS account:"),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Go to ",(0,o.kt)("strong",{parentName:"li"},"EC2")," \u2192 ",(0,o.kt)("strong",{parentName:"li"},"Instances")),(0,o.kt)("li",{parentName:"ol"},"Click on your relevant EC2 bastion, see ",(0,o.kt)("a",{parentName:"li",href:"#environments"},"environments")),(0,o.kt)("li",{parentName:"ol"},"Under the ",(0,o.kt)("strong",{parentName:"li"},"Details")," tab and ",(0,o.kt)("strong",{parentName:"li"},"Instance summary")," section, copy the ",(0,o.kt)("strong",{parentName:"li"},"Public IPv4 DNS"))),(0,o.kt)("p",null,"Back within your database client:"),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Create a SSH tunnel and set the copied value for Public IPv4 DNS as the ",(0,o.kt)("strong",{parentName:"li"},"host")," and ",(0,o.kt)("strong",{parentName:"li"},"ec2-user")," as the username")),(0,o.kt)("p",null,"Back in AWS:"),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"Go to ",(0,o.kt)("strong",{parentName:"li"},"Secrets Manager")),(0,o.kt)("li",{parentName:"ol"},"Search for ",(0,o.kt)("strong",{parentName:"li"},"social-care-workflows_< environment-key >_private_key"),", replacing ",(0,o.kt)("strong",{parentName:"li"},"< environment-key >")," with the key\nfor the environment e.g. social-care-workflows_stg_private_key, see ",(0,o.kt)("a",{parentName:"li",href:"#environments"},"environments")),(0,o.kt)("li",{parentName:"ol"},"Click on the ",(0,o.kt)("strong",{parentName:"li"},"social-care-workflows_< environment-key >_private_key")," secret"),(0,o.kt)("li",{parentName:"ol"},"Under ",(0,o.kt)("strong",{parentName:"li"},"Secret value"),", click on ",(0,o.kt)("strong",{parentName:"li"},"Retrieve secret value")),(0,o.kt)("li",{parentName:"ol"},"Copy the private key")),(0,o.kt)("p",null,"On your local machine:"),(0,o.kt)("ol",{start:12},(0,o.kt)("li",{parentName:"ol"},"Create a new ",(0,o.kt)("inlineCode",{parentName:"li"},".pem")," file in your ",(0,o.kt)("inlineCode",{parentName:"li"},"~/.ssh")," folder e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"social-care-workflows-staging.pem")," with the private key")),(0,o.kt)("p",null,"Back within your database client:"),(0,o.kt)("ol",{start:13},(0,o.kt)("li",{parentName:"ol"},'Select authentication type as "key pair" or similar'),(0,o.kt)("li",{parentName:"ol"},"Select the path of the private key you just created as the private key file for the SSH tunnel")),(0,o.kt)("p",null,"Back in AWS:"),(0,o.kt)("ol",{start:15},(0,o.kt)("li",{parentName:"ol"},"Go to ",(0,o.kt)("strong",{parentName:"li"},"Systems Manager")," \u2192 ",(0,o.kt)("strong",{parentName:"li"},"Parameter Store")),(0,o.kt)("li",{parentName:"ol"},"Search for ",(0,o.kt)("strong",{parentName:"li"},"social-care-workflows-< environment-key >/database/url"),", replacing ",(0,o.kt)("strong",{parentName:"li"},"< environment-key >")," with the key\nfor the environment, see ",(0,o.kt)("a",{parentName:"li",href:"#environments"},"environments")),(0,o.kt)("li",{parentName:"ol"},"Click on the ",(0,o.kt)("strong",{parentName:"li"},"social-care-workflows-< environment-key >/database/url")," parameter store value"),(0,o.kt)("li",{parentName:"ol"},"Click on ",(0,o.kt)("strong",{parentName:"li"},"Show")," for the ",(0,o.kt)("strong",{parentName:"li"},"Value"))),(0,o.kt)("p",null,"Back within your database client:"),(0,o.kt)("ol",{start:19},(0,o.kt)("li",{parentName:"ol"},'Under "General" or similar, fill in the values for ',(0,o.kt)("strong",{parentName:"li"},"host"),", ",(0,o.kt)("strong",{parentName:"li"},"port"),", ",(0,o.kt)("strong",{parentName:"li"},"user"),", ",(0,o.kt)("strong",{parentName:"li"},"password")," and ",(0,o.kt)("strong",{parentName:"li"},"database")," by\nextracting parts of the database URL")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"postgres://<USER>:<PASSWORD>@<HOST>:<PORT>/<DATABASE>\n")),(0,o.kt)("ol",{start:20},(0,o.kt)("li",{parentName:"ol"},"Test and create the data source")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\ud83d\udca1 ",(0,o.kt)("strong",{parentName:"p"},"Hint"),": Some database clients allow you to set a data source as\nread-only, this is to prevent accidentally making changes on a database you\ndidn't mean to. Further to this, if helpful for you, some clients also allow\nyou to customise the colour of each connection, so you can more easily differentiate them.\nIf possible, set these for production.")),(0,o.kt)("p",null,"Tables live under the ",(0,o.kt)("inlineCode",{parentName:"p"},"public")," schema, see below for an example query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},'SELECT * FROM public."Workflow" LIMIT 10;\n')))}k.isMDXComponent=!0}}]);