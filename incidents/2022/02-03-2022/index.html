<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<title data-react-helmet="true">Incident Report 02-03-2022 | Social Care System</title><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io//social-care-architecture/incidents/2022/02-03-2022/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Incident Report 02-03-2022 | Social Care System"><meta data-react-helmet="true" name="description" content="Summary"><meta data-react-helmet="true" property="og:description" content="Summary"><link data-react-helmet="true" rel="shortcut icon" href="/social-care-architecture/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io//social-care-architecture/incidents/2022/02-03-2022/"><link data-react-helmet="true" rel="alternate" href="https://lbhackney-it.github.io//social-care-architecture/incidents/2022/02-03-2022/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://lbhackney-it.github.io//social-care-architecture/incidents/2022/02-03-2022/" hreflang="x-default"><link rel="stylesheet" href="/social-care-architecture/assets/css/styles.577370b9.css">
<link rel="preload" href="/social-care-architecture/assets/js/runtime~main.d91d8df3.js" as="script">
<link rel="preload" href="/social-care-architecture/assets/js/main.4a219d06.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/social-care-architecture/"><img src="/social-care-architecture/img/logo.svg" alt="Hackney Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/social-care-architecture/img/logo.svg" alt="Hackney Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Social Care System</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/social-care-architecture" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/social-care-architecture/"><img src="/social-care-architecture/img/logo.svg" alt="Hackney Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/social-care-architecture/img/logo.svg" alt="Hackney Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Social Care System</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/social-care-architecture" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/related-repositories/">Related repositories</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/process/">Process</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">System Logbook</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/mash-referrals/">MASH Referrals</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture decision records (ADRs)</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/decisions/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/decisions/record-architecture-decisions/">1. Record architecture decisions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/decisions/use-iso-8601-format-for-dates/">2. Use ISO 8601 format for dates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/decisions/prefer-open-source-software/">3. Prefer open source software</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/decisions/drop-mash-mongodb-collection/">4. Drop MASH MongoDB Collection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Runbooks</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Case Viewer</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Everyday</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/runbooks/case-viewer/every-day/adding-a-new-team/">Add a new team</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/runbooks/case-viewer/development/connect-to-social-care-case-viewer-api/">Connecting to the case viewer API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Social Care Search Functionality</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Residents Search</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/runbooks/case-viewer/search-functionality/resident-search/">Resident Search Configuration</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Core Pathways</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Every Day</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/runbooks/core-pathways/every-day/connecting-to-live-databases/">Connecting to live databases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/social-care-architecture/runbooks/core-pathways/every-day/working-with-audit-tables/">Working with Audit Tables</a></li></ul></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Incidents</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">2022</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">02-03-2022</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/social-care-architecture/incidents/2022/02-03-2022/">Incident Report 02-03-2022</a></li></ul></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Incident Report 02-03-2022</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h3><p>At <code>14:20 GMT</code> a deployment to production was completed and users reported they were getting error messages. The root cause of the issue was that a new banner that was added to the page did not consistently contain a URL that was required for it to work. This meant that some users were unable to access residents&#x27; pages. The issue was fully resolved at <code>15:40 GMT</code> and the application was fully functional again.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="timeline"></a>Timeline<a class="hash-link" href="#timeline" title="Direct link to heading">#</a></h3><p>14:20 GMT - A deployment to production was completed</p><p>14:21 GMT - First report of the incident, reports of </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;error&quot;:&quot;Error logging in&quot;}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>14:26 GMT - Reports of a different error message </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">“Error message: Cannot read properties of undefined (reading &#x27;auth&#x27;)”</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>14:30 GMT - Developers start mobbing to identify and resolve the issue</p><p>15:18 GMT - Communication was sent to the Children and Family Service (CFS) to explain an issue has occurred and a fix is being worked on</p><p>15:18 GMT - Communication was sent to the Adults Social Care (ASC) service to explain an issue has occurred and a fix is being worked on.
(Alex noted that the initial comms bounced back so he had to contact them by an alternative method)</p><p>15:40 GMT - A fix was released to production that resolves the issue</p><p>15:44 GMT - Communication was sent to CFS to confirm the issue has been resolved</p><p>15:44 GMT - Communication was sent to ASC to confirm the issue has been resolved</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="root-cause"></a>Root Cause<a class="hash-link" href="#root-cause" title="Direct link to heading">#</a></h3><p>During a planned deployment to production, a preview banner was added to the resident view that gave the option to use a new resident view and provide feedback. The link to provide feedback was not consistently populating. Due to this, the resident view was not consistently rendered and some users were experiencing an error stating </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">“Error message: Cannot read properties of undefined (reading &#x27;auth&#x27;)”.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="technical-detail"></a>Technical Detail<a class="hash-link" href="#technical-detail" title="Direct link to heading">#</a></h3><ul><li><p>The preview banner that was added used a Link field along with an href attribute. </p></li><li><p>Link fields will attempt to prefetch the href that has been passed. Link fields use a <code>formatUrl</code> function to properly format the URL. </p></li><li><p>The first step of the <code>formatUrl</code> function is to destructure the passed in URL. If no URL is passed to the <code>formatUrl</code> function then the function is unable to destructure this and an error is thrown. This was the error that was seen by users during this incident.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resolution-and-recovery"></a>Resolution and Recovery<a class="hash-link" href="#resolution-and-recovery" title="Direct link to heading">#</a></h3><ul><li>As an immediate resolution, the new preview banner was removed from the resident view. This resolved the issue for users. </li><li>This issue with the preview banner meant that certain pages were not loading however no data was lost due to this issue and recovery was not required.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="corrective-and-preventive-measures"></a>Corrective and preventive measures<a class="hash-link" href="#corrective-and-preventive-measures" title="Direct link to heading">#</a></h3><ul><li>The preview banner was reviewed further following the resolution of this incident. </li><li>The code was changed to use a different field to display the link to the feedback form rather than a Link, this provides a more robust way of showing a link. </li><li>To prevent a scenario where the feedback form URL was unavailable, the URL was hardcoded into the new field. </li></ul><p>This was tested and deployed to production on 03/03/2022.</p><p>—---------------------------------------------------------------------------</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="incident-commentary"></a>Incident Commentary<a class="hash-link" href="#incident-commentary" title="Direct link to heading">#</a></h3><p>Setting: remote group mobbing</p><p>Screen presenter: Rachel Hutchinson - Made Tech</p><p>Scribe: Tony Griffin - Made Tech</p><p>—---------------------------------------------------------------------------</p><p>2:30 pm onwards</p><ul><li><p>Dev team made aware of incident</p></li><li><p>Mobbed from this time onwards</p></li><li><p>Cloudwatch production account was checked for error warnings</p></li><li><p>Tuomo confirmed there were normal amount of errors appearing in Cloudwatch</p></li><li><p>Lawrence asks if we’ve tested the URL that we were sent, ie the <code>“/people/[id]”</code></p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Error in console: </span></span><span class="token-line" style="color:#393A34"><span class="token plain">“Cannot read properties of undefined ( reading ‘auth’ )</span></span><span class="token-line" style="color:#393A34"><span class="token plain">At Object.t.formatURL ( )&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>-- Question:  What’s changed recently?</code></p><ul><li>Identified newly deployed code has rolled to prod and coincides with the start of the incident (roughly 7 mins before devs were notified of the incident)</li></ul><p><code>-- Question:  Is it tested?</code></p><ul><li>Lawrence asks if it was tested/has tests written?</li></ul><p><code>Sentry:</code> Check the Main Application</p><ul><li>The difficulty here is to spot errors without a good source map being available in Sentry</li></ul><p><code>AWS:</code> Errors in lambda logs</p><p>Tuomo:
Says he’s seeing 403 errors in the front end Lambda logs that he hasn’t seen before</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">“Lambda runtime failed to post handler success response 403”</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>-- Question:  Has the API key been changed?</code></p><ul><li>Lawrence asks if the API key has changed for any reason? - Apparently not</li></ul><p><code>-- Question: Quickest fix a redeployment?</code></p><ul><li><p>Rachel asked if the quickest fix is to redeploy the last working deployment? - Possibly yes</p></li><li><p>Lawrence confirms the error is definitely in the FE as there is no accompanying HTTP error.</p></li><li><p>The error appears due to some kind of object destructuring as per the console error. </p></li><li><p>Due to the <code>“System Error”</code> banner appearing on pages, the error never hits Sentry properly so we don’t get a stack trace of the error.</p></li><li><p>Jack notes that if you change <code>“/people/[id]”</code> to the newer URL of <code>“/residents/[id]”</code> then that works correctly.</p></li><li><p>Jaye says people and residents use the same API endpoint, so have the same data source.</p></li><li><p>He lets us know that 404 errors can be thrown by the app trying to extract worker’s names from their email (So they are expected errors in some cases)</p></li></ul><p><code>Remove Banner component code</code></p><ul><li><p>(Rachel removed the Banner code changes for the repo at this stage)</p></li><li><p>This is this code that we believe is generating the error</p></li></ul><p><a href="https://github.com/LBHackney-IT/lbh-social-care-frontend/pull/870" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/lbh-social-care-frontend/pull/870</a> </p><p>3:08 pm onwards</p><p><code>Same error reported previously</code></p><ul><li>Lawrence notes that the same error has been noted before - the error is definitely due to the <code>&lt;Link&gt;</code> tag &amp; how it does restructuring on the URL object.</li></ul><p>(Happening in the pre-build phase when deploying to Vercel’s set up) in the static content build possibly?</p><p> <a href="https://github.com/vercel/next.js/issues/30028" target="_blank" rel="noopener noreferrer">https://github.com/vercel/next.js/issues/30028</a> </p><p><code>-- Question:  Need for FEEDBACK_URL?</code></p><ul><li><p>Rachel asks if we need the <code>NEXT_PUBLIC_FEEDBACK_URL</code>?
(To be decided) </p></li><li><p>At this point we know it&#x27;s definitely one of the links on the pages</p></li></ul><p><code>-- Question:  Why does it work on Staging but not Production?</code></p><ul><li><p>Jaye notes that this works on staging but not on prod.</p></li><li><p>Rachel notes that we don’t see this preview banner for an Adult on staging.</p></li><li><p>This leads to investigating the feature flag set up later</p></li></ul><p><code>Error thrown from inside node modules</code></p><ul><li>Lawrence identifies the line throwing an error</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">node_modules/next/dist/shared/lib/router/utils/format-url.js ( line:32 )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><code>“urlObj&quot;</code> is undefined</li><li>NextJS’s router uses this in it’s <code>LINK</code> component on its <code>“href”</code> attribute</li></ul><p><code>PreviewBanner component</code></p><ul><li><p>PhaseBanner component uses a straight <code>&lt;a&gt;</code> tag</p></li><li><p>PreviewBanner component  uses a <code>&lt;Link&gt;</code> tag and it doesn’t have a <code>“href”</code> set to true, so it tries to do a pre-fetch on the URL &amp; if the URL is undefined it will fail and throw an error.</p></li><li><p><code>&lt;Link&gt;</code> tags are meant to be used to link to resources internal to the application only, not external links.</p></li></ul><p><strong>This component was removed from the application as we believed it was the source of the issue.</strong></p><p><code>Fix: Deployment to Staging</code></p><ul><li><p>Rachel lined up some people on Staging to see if the deployment had fixed the problem</p></li><li><p>The following is an adults record:</p></li></ul><p>Rachel checked:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">“/residents/7” </span></span><span class="token-line" style="color:#393A34"><span class="token plain">“/residents/7/details”</span></span><span class="token-line" style="color:#393A34"><span class="token plain">“/residents/7/workflows”</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Must wait till the deployment changes hit production to confirm the fix</li></ul><p><code>Fix: Deployment to Production</code></p><p>3:35 pm</p><ul><li><p>Person we checked on prod: <code>“/residents/14”</code></p></li><li><p>Banner component was totally removed</p></li><li><p>Contacted Alex at this time to let him know.</p></li></ul><p><code>Notes on types of people records checked</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Adult: “/people/34”  Foo Bar</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Child: “/people/19”   Cristobal Cawdell (I believe to be a Child  record, redirects to “/residents/19”) (Not sure on this?)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Location of error in the PreviewBanner component</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/components/NewPersonView/PreviewBanner.tsx     (Line: 32)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Feature flag setup</code></p><ul><li><p>We noted that we don’t see this preview banner for an Adult on staging.</p></li><li><p>This picks up on Rachel’s earlier comment and leads to investigating the feature flag &amp; seeing that we can’t see the Banner component in Staging as the feature flag was set up to only be active on production.</p></li></ul><p><code>Issues Identified after the Deployment</code></p><ul><li><p>PreviewBanner component needs to be rewritten so it uses a straight a tag and removes the tag.</p></li><li><p>Work out why the env var <code>NEXT_PUBLIC_FEEDBACK_URL</code> isn’t set when the app is built?.
Lawrence suggests making it a non <code>NEXT_PUBLIC</code> env var in CircleCi</p></li><li><p>Sort error boundaries within the Next’s app - to allow Sentry to retrieve errors </p></li></ul><ul><li><p>Tuomo suggests hardcoding the <code>FEEDBACK_URL</code> as the form is restricted to Hackney staff.</p></li><li><p>We confirmed that this was the case by having Jack try to access the <code>FEEDBACK_URL</code> form using his Made Tech account and was unable to.</p></li></ul><ul><li><p>We hardcoded the <code>FEEDBACK_URL</code> in the <code>PhaseBanner</code> and <code>PreviewBanner</code> components &amp; remove reference to it in the serverless.yml file in the application.</p></li><li><p>Deleted <code>NEXT_PUBLIC_FEEDBACK_URL</code> from CircleCI &amp; the AWS Staging and Prod environments</p></li></ul><p><code>Follow up Commits</code></p><ul><li>Re-added: Preview Banner - to <code>“pages/people/[id]”</code> &amp; rewrote component to use an <code>&lt;a&gt;</code> tag.</li></ul><p><a href="https://github.com/LBHackney-IT/lbh-social-care-frontend/pull/871/files" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/lbh-social-care-frontend/pull/871/files</a></p><ul><li>Update feature flag - to show everywhere except for on production environment</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="action-points"></a>Action points<a class="hash-link" href="#action-points" title="Direct link to heading">#</a></h3><ul><li>Ensure all code is supported by having tests written for it.</li><li>Breaking changes should show up when a piece of code has tests written around it.</li><li>Create a pull request and have another engineer look over the proposed changes</li><li>Before deploying - Always send a message in the relevant channels that you would like to do a deployment and check how this may affect the work of others.</li><li>The current deployment process will push all code that is ready to be deployed, not just yours.</li><li>Clear channels for communications to both the CSF and ASC services should be set up and verified to enable quick correspondence between us and the services should there be need to contact them quickly in the future.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/LBHackney-IT/social-care-architecture/edit/main/docs/incidents/2022/02-03-2022.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/social-care-architecture/runbooks/core-pathways/every-day/working-with-audit-tables/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Working with Audit Tables</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#timeline" class="table-of-contents__link">Timeline</a></li><li><a href="#root-cause" class="table-of-contents__link">Root Cause</a></li><li><a href="#technical-detail" class="table-of-contents__link">Technical Detail</a></li><li><a href="#resolution-and-recovery" class="table-of-contents__link">Resolution and Recovery</a></li><li><a href="#corrective-and-preventive-measures" class="table-of-contents__link">Corrective and preventive measures</a></li><li><a href="#incident-commentary" class="table-of-contents__link">Incident Commentary</a></li><li><a href="#action-points" class="table-of-contents__link">Action points</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/social-care-architecture/">About</a></li><li class="footer__item"><a class="footer__link-item" href="/social-care-architecture/decisions/">Architecture Decision Records (ADRs)</a></li></ul></div><div class="col footer__col"><div class="footer__title">Related repositories</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/LBHackney-IT/lbh-social-care-frontend" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Social Care Frontend<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/LBHackney-IT/social-care-case-viewer-api" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Social Care Case Viewer API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/LBHackney-IT/residents-social-care-platform-api" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Residents Social Care Platform API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/LBHackney-IT/lbh-adult-social-care-frontend" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Adult Social Care Care Package Builder Frontend<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/LBHackney-IT/lbh-adult-social-care-api" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Adult Social Care Care Package Builder API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/LBHackney-IT/lbh-adult-social-care-transactions-api" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Adult Social Care Package Builder Transactions API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/LBHackney-IT/infrastructure" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Infrastructure<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Hackney Playbooks</div><ul class="footer__items"><li class="footer__item"><a href="https://playbook.hackney.gov.uk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Directory<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://playbook.hackney.gov.uk/API-Playbook/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>API Playbook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://playbook.hackney.gov.uk/Infrastructure-Playbook/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Infrastructure Playbook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/social-care-architecture/assets/js/runtime~main.d91d8df3.js"></script>
<script src="/social-care-architecture/assets/js/main.4a219d06.js"></script>
</body>
</html>